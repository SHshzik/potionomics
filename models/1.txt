Всем привет.
У меня возник очень сложный, лично для меня, математический/комбинаторический/вычислительный и т.д. и т.п. вопрос.

Для начала контекст для максимального понимания.

На днях вышла игра про алхимию, где можно, забрасывая в котёл для варки различные ингредиенты, варить зелья.

Каждое зелье варится по определённой пропорции магического элемента [A, B, C, D, E]. Это всегда простые пропорции [1, 1, 0, 0, 0] или [0, 0, 3, 3, 4]. У зелье есть рейтинг. Чем лучше рейтинг, тем дороже он стоит.
Каждый ингредиент содержит в себе магический элемент [A, B, C, D, E] определённого размера. Это может быть один или несколько сразу, например [8, 0, 0, 0, 0] или [0, 24, 8, 0, 12]. Каждые два ингредиента в котле - это 1 зелье на выходе. Закинем 6 ингредиентов - получим 3 зелья в результате.
Котлы же различаются количеством ингредиентов, которые можно в них положить (4, 6 или 8) ( скорее всего по мере прохождения дадут и больше ), а так же максимумом суммы магических элементов ( то есть нельзя положить в чан с максимумом в 100 магии два ингредиента с магией по 70 ).

Это три базовых концепции, вокруг которых строится варка.

Пример:
Возьмём зелье с пропорцией [1, 1, 0, 0, 0]. Берём ингредиент [8, 0, 0, 0, 0] и ингредиент [0, 8, 0, 0, 0]. Результат - [8, 8, 0, 0, 0] - чистая пропорция 50/50. Результат 1 зелье. Докинем еще по одному таких же и получим [16, 16, 0, 0, 0] - всё тоже отлично, но уже два зелья. К каждому такому зелью в результате прибавиться рейтинг, т.к. он прекрасно сварен.

Но есть еще кое что. Мы можем строить не идеальные пропорции. К примеру зелье с таким результатом - [32, 32, 4, 0, 0] - тоже сработает, но есть шанс того, что к рейтингу никакого плюса не будет ( а в случае совсем прохих пропорций - рейтинг может совсем упасть или вообще не свариться ) ( опытным путём я вывел для себя отклонение в 7% он идеальной пропорции ).

Зачем же делать не идеальные зелья? Есть ингредиенты с составом [96, 12, 12, 12, 0]. В чистом виде ни для одного из возможных зельев не подходит, но при добавлении может дать сильный буст к общему результату, но испортив полностью результат.
Но выкинем эти варианты, т.к. мы ищем идеальные варианты.

Со вступлением всё. Дальше.

Игра мне понравилась на столько, что в голову пришла одна мысль - а какой вариант комбинации ингредиентов был бы идеальным? И я начал писать программу. Писал я её на ruby и по первой всё было отлично.

В начале у меня было всего 4 места под ингредианты, а в интвентаре лежало всего 10 ингредиентов. То программа брала все эти ингредиенты, комбинировала, а потом на выходе проверяла эти комбинации на соответствия всем условиям, что описаны выше. То есть искала идеальную пропорцию.

Кобинации мне любезно предоставил метод `repeated_combination`, который идеально подходил для меня. Для 10 ингредиентов и 4 места, количество комбинаций было всего 715 ( ничто для современного компьютера ), но потому количество ингредиентов выросло до 27, а место до 6. А это уже 906_192.

Всё еще не так много, но я встал в полный тупик, когда получил котёл на 8 места. 18_156_204 - это уже совсем не быстро.

А будущие возможность... ~200 ингредиентов и максимальный объём в 12 мест. Даже если взять только те ингредиенты, что нужно для определённого зелья ~70 из ~200, на 12 мест - это 12_124_169_174_520 возможных комбинаций. Из них, наверное, только 1% подходит под рецептуру. 

И вот я тут. Хочу просить помощи/идей/подсказок от вас. Что бы я мог сделать, что бы добиться результата в своих изысканиях? Может быть есть какие-то варианты оптимизации? Может быть нужно сменить язык программирование на, например, GO, потому что он компилируемый и работает на выходе быстрее ( что про объёмах вычисления гигантские числа ). Может мне нужно выбрать другой алгоритм комбинаций? Или может есть какие-то алгоритмы с учётом данных, а не тупой перебор?

Желаемый результат: спрашивать у программы - как мне сварить вот такое зелье и получить лучший результат; и получить в ответ - список из топовых комбинаций ингредиентов.

P.S.
На текущий момент я просто генерирую в БД список комбинаций для всех зелий ( их 20 штук ).

P.S.S.
Не думаю, что можно дожить до конца генерации комбинаций для 12 мест.
